<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CricketPlay — Fake Coins</title>
  <style>
    :root { --main:#0b82ff; --card:#fff; --bg:#f3f6fb; --muted:#666; }
    body{font-family:system-ui,Arial;background:var(--bg);margin:0;padding:20px;}
    .wrap{max-width:900px;margin:20px auto;display:grid;grid-template-columns:1fr 1fr;gap:18px;}
    .card{background:var(--card);border-radius:10px;padding:18px;box-shadow:0 6px 18px rgba(20,20,20,0.06);}
    h2{margin:0 0 10px 0}
    input, select, button, textarea{width:100%;padding:10px;margin-top:8px;border:1px solid #ddd;border-radius:6px;box-sizing:border-box}
    button{background:var(--main);color:#fff;border:none;cursor:pointer}
    small{color:var(--muted)}
    .full{grid-column:1/3}
    .row{display:flex;gap:8px}
    .row > *{flex:1}
    .log{white-space:pre-wrap;background:#f8f9fb;padding:8px;border-radius:6px;border:1px dashed #eee;margin-top:8px}
    .matches li{margin:8px 0;padding:8px;border-radius:6px;border:1px solid #f0f0f0;display:flex;justify-content:space-between;align-items:center}
  </style>
</head>
<body>

<div style="max-width:1100px;margin:10px auto;">
  <h1 style="text-align:center">CricketPlay — Fake Coins Demo</h1>
  <p style="text-align:center; color:#444">Demo site — not real money. Register, verify email, play with virtual coins.</p>

  <div class="wrap">

    <!-- REGISTER -->
    <div class="card">
      <h2>Register</h2>
      <small>(email or phone, password required)</small>
      <input id="r_email" placeholder="Email (optional)">
      <input id="r_phone" placeholder="Phone (optional, e.g. +9198...)">
      <input id="r_pass" placeholder="Password" type="password">
      <input id="r_name" placeholder="Display name (optional)">
      <button onclick="doRegister()">Create account</button>
      <div id="reg_log" class="log"></div>
    </div>

    <!-- LOGIN -->
    <div class="card">
      <h2>Login</h2>
      <input id="l_email" placeholder="Email">
      <input id="l_pass" placeholder="Password" type="password">
      <button onclick="doLogin()">Login</button>
      <button style="background:#444;margin-top:8px" onclick="doLogout()">Logout</button>
      <div id="login_log" class="log"></div>
    </div>

    <!-- EMAIL VERIFY -->
    <div class="card">
      <h2>Email Verification</h2>
      <input id="verify_email_input" placeholder="Your registered email">
      <button onclick="sendVerify()">Send verification email</button>
      <small>Check inbox. (In dev mode backend may return token.)</small>
      <div id="verify_log" class="log"></div>
    </div>

    <!-- DASHBOARD -->
    <div class="card">
      <h2>Dashboard</h2>
      <div style="display:flex;gap:8px">
        <button onclick="loadBalance()">Get Balance</button>
        <button onclick="loadMatches()">Load Matches</button>
      </div>
      <div id="dash" style="margin-top:10px">
        <div><strong>User:</strong> <span id="u_email">—</span></div>
        <div><strong>Credits:</strong> <span id="u_credits">—</span></div>
        <div><strong>PAN verified:</strong> <span id="u_pan">—</span></div>
      </div>
    </div>

    <!-- MATCHES & BET -->
    <div class="card">
      <h2>Matches & Place Bet</h2>
      <ul id="matches" class="matches"></ul>

      <h3 style="margin-top:10px">Place Bet (virtual coins)</h3>
      <input id="bet_match_id" placeholder="Match ID">
      <input id="bet_amount" placeholder="Amount (integer)">
      <input id="bet_selection" placeholder="Selection (TeamA/TeamB)">
      <button onclick="placeBet()">Place Bet</button>
      <div id="bet_log" class="log"></div>
    </div>

    <!-- ADMIN (simple) -->
    <div class="card full">
      <h2>Admin: Create Match (simple)</h2>
      <small>Note: admin endpoints require header X-ADMIN-SECRET set on backend</small>
      <input id="m_title" placeholder="Match title">
      <input id="m_time" placeholder="Start time (ISO e.g. 2025-12-02T18:00:00) (optional)">
      <div class="row">
        <input id="admin_secret" placeholder="ADMIN SECRET">
        <button onclick="createMatch()">Create</button>
      </div>
      <div id="admin_log" class="log"></div>
    </div>

  </div>
</div>

<script>
/* ========== SET API BASE ==========
   Replace with your backend public URL (no trailing slash)
   Example: const API_BASE = "https://myapp.onrender.com"
*/
const API_BASE = "https://your-backend-url-here";

/* helper to show logs */
function show(id, msg){ document.getElementById(id).innerText = typeof msg === "string" ? msg : JSON.stringify(msg, null, 2); }

/* REGISTER */
async function doRegister(){
  const email = document.getElementById("r_email").value.trim();
  const phone = document.getElementById("r_phone").value.trim();
  const password = document.getElementById("r_pass").value;
  const display_name = document.getElementById("r_name").value.trim();
  const body = { email: email||undefined, phone: phone||undefined, password, display_name };
  const res = await fetch(API_BASE + "/register", {
    method:"POST",
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(body),
    credentials: 'include'
  });
  const data = await res.json();
  show("reg_log", {status: res.status, data});
}

/* LOGIN */
async function doLogin(){
  const email = document.getElementById("l_email").value.trim();
  const password = document.getElementById("l_pass").value;
  const res = await fetch(API_BASE + "/login", {
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({email, password}),
    credentials: 'include'
  });
  const data = await res.json();
  show("login_log", {status: res.status, data});
}

/* LOGOUT */
async function doLogout(){
  await fetch(API_BASE + "/logout", {method:"POST", credentials:'include'});
  show("login_log", "Logged out");
  document.getElementById("u_email").innerText = "—";
  document.getElementById("u_credits").innerText = "—";
}

/* SEND EMAIL VERIFY */
async function sendVerify(){
  const email = document.getElementById("verify_email_input").value.trim();
  const res = await fetch(API_BASE + "/send_email_verify", {
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({email})
  });
  const data = await res.json();
  show("verify_log", {status: res.status, data});
}

/* LOAD BALANCE */
async function loadBalance(){
  const res = await fetch(API_BASE + "/balance", {method:"GET", credentials:'include'});
  const d = await res.json();
  if(res.ok){
    document.getElementById("u_email").innerText = d.email || "—";
    document.getElementById("u_credits").innerText = d.virtual_credits;
    document.getElementById("u_pan").innerText = d.pan_verified ? "Yes" : "No";
    show("dash", d);
  } else show("dash", {status:res.status, data:d});
}

/* LOAD MATCHES */
async function loadMatches(){
  const res = await fetch(API_BASE + "/matches");
  const d = await res.json();
  const ul = document.getElementById("matches");
  ul.innerHTML = "";
  if(d.matches && d.matches.length){
    d.matches.forEach(m=>{
      const li = document.createElement("li");
      li.innerHTML = `<div><strong>${m.title}</strong><br><small>ID:${m.id} • ${m.status} • ${new Date(m.start_time).toLocaleString()}</small></div>
                      <div><button onclick="fillBet(${m.id})">Bet</button></div>`;
      ul.appendChild(li);
    });
  } else {
    ul.innerHTML = "<li>No matches</li>";
  }
  show("admin_log", d);
}
function fillBet(id){ document.getElementById("bet_match_id").value = id; }

/* PLACE BET */
async function placeBet(){
  const match_id = parseInt(document.getElementById("bet_match_id").value);
  const amount = parseInt(document.getElementById("bet_amount").value);
  const selection = document.getElementById("bet_selection").value.trim();
  const res = await fetch(API_BASE + "/bet", {
    method:"POST",
    headers:{'Content-Type':'application/json'},
    credentials:'include',
    body: JSON.stringify({match_id, amount, selection})
  });
  const d = await res.json();
  show("bet_log", {status:res.status, data:d});
}

/* ADMIN CREATE MATCH */
async function createMatch(){
  const title = document.getElementById("m_title").value || "Match";
  const start_time = document.getElementById("m_time").value || undefined;
  const admin_secret = document.getElementById("admin_secret").value || "";
  const res = await fetch(API_BASE + "/admin/create_match", {
    method:"POST",
    headers:{'Content-Type':'application/json','X-ADMIN-SECRET': admin_secret},
    body: JSON.stringify({title, start_time})
  });
  const d = await res.json();
  show("admin_log", {status:res.status, data:d});
}

/* Quick page init */
document.addEventListener("DOMContentLoaded", ()=>{
  // try to load matches automatically
  loadMatches();
});
</script>
</body>
</html>
